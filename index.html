<!DOCTYPE html>
<html>
<head>
    <title>Control ESP8266 via MQTT.js</title>
    <!-- Cargar MQTT.js desde CDN -->
    <script src="https://unpkg.com/mqtt@4.3.7/dist/mqtt.min.js"></script>
</head>
<body>
    <h1>Control ESP8266 con MQTT.js</h1>
    <button onclick="sendCommand('on')">ENCENDER LED</button>
    <button onclick="sendCommand('off')">APAGAR LED</button>

    <script>
        // Configuraci贸n MQTT
        const brokerUrl = "wss://test.mosquitto.org:8081/mqtt"; // WebSocket seguro
        const topic = "casa/led";

        // Conexi贸n al broker
        const client = mqtt.connect(brokerUrl, {
            clientId: "web_" + Math.random().toString(16).substr(2, 8),
            clean: true,
            reconnectPeriod: 1000
        });

        // Manejar conexi贸n
        client.on("connect", () => {
            console.log("? Conectado al broker MQTT");
        });

        // Funci贸n para enviar comandos
        function sendCommand(message) {
            client.publish(topic, message, { qos: 0 }, (err) => {
                if (!err) {
                    console.log("?? Enviado:", message);
                } else {
                    console.error("? Error al enviar:", err);
                }
            });
        }

        // Manejar errores
        client.on("error", (err) => {
            console.error("? Error MQTT:", err);
        });
    </script>
</body>
</html>
