<!DOCTYPE html>
<html>
<head>
    <title>Control ESP8266 via MQTT</title>
    <!-- Carga Paho MQTT desde un CDN confiable -->
    <script src="https://cdn.jsdelivr.net/npm/paho-mqtt@1.2.0/paho-mqtt-min.js"></script>
</head>
<body>
    <h1>Control del ESP8266 con MQTT</h1>
    <button onclick="sendMQTT('on')">Encender LED</button>
    <button onclick="sendMQTT('off')">Apagar LED</button>

    <script>
        // Configuración MQTT
        const clientId = "web_" + Math.random().toString(16).substr(2, 8);
        const host = "wss://test.mosquitto.org:8081"; // WebSocket seguro
        const topic = "casa/led"; // Mismo tópico que en el ESP8266

        // Inicializa el cliente MQTT
        const client = new Paho.Client(host, clientId); // ¡Ojo! Es "Paho.Client", no "Paho.MQTT.Client"

        function sendMQTT(message) {
            const messageObj = new Paho.Message(message); // ¡Ojo! Es "Paho.Message", no "Paho.MQTT.Message"
            messageObj.destinationName = topic;
            client.send(messageObj);
            console.log("Enviado: " + message);
        }

        // Conexión al broker
        client.connect({
            onSuccess: () => {
                console.log("Conectado al broker MQTT");
            },
            onFailure: (err) => {
                console.error("Error de conexión:", err.errorMessage);
            }
        });
    </script>
</body>
</html>
